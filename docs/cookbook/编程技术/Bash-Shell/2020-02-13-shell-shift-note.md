---
title: Linux shift 命令用法笔记
urlname: 2020-02-13-shell-shift-note
author: 章鱼猫先生
date: 2020-02-13
updated: "2023-08-01 01:13:26"
---

## 特殊变量

首先来看几个特殊变量：

```bash
#!/bin/bash
echo $0    # 当前脚本的文件名（间接运行时还包括绝对路径）。
echo $n    # 传递给脚本或函数的参数。n 是一个数字，表示第几个参数。例如，第一个参数是 $1 。
echo $#    # 传递给脚本或函数的参数个数。
echo $*    # 传递给脚本或函数的所有参数。
echo $@    # 传递给脚本或函数的所有参数。被双引号 (" ") 包含时，与 $* 不同，下面将会讲到。
echo $?    # 上个命令的退出状态，或函数的返回值。
echo $$    # 当前 Shell 进程 ID。对于 Shell 脚本，就是这些脚本所在的进程 ID。
echo $_    # 上一个命令的最后一个参数。
echo $!    # 后台运行的最后一个进程的 ID 号。
```

保存为一个脚本，然后加上几个参数运行，结果如下：

```bash
$ ./test.sh A B B D E
./test.sh     # $0, 当前脚本的文件名（间接运行时还包括绝对路径）。
              # $n, 传递给脚本或函数的参数。n 是一个数字，表示第几个参数。例如，第一个参数是 $1。
5             # $#, 传递给脚本或函数的参数个数。
A B B D E     # $*, 传递给脚本或函数的所有参数。
A B B D E     # $@, 传递给脚本或函数的所有参数。被双引号 (" ") 包含时，与 $* 不同，下面将会讲到。
0             # $?, 上个命令的退出状态，或函数的返回值。
24946         # $$, 当前 Shell 进程 ID。对于 Shell 脚本，就是这些脚本所在的进程 ID。
24946         # $_, 上一个命令的最后一个参数。
              # $!, 后台运行的最后一个进程的 ID 号。
```

`$*` 和 `$@` 都表示传递给函数或脚本的所有参数，不被双引号 ("") 包含时，都以 "$1""$2" … "$n" 的形式输出所有参数。但是当它们被双引号 ("") 包含时，"`$*`"会将所有的参数作为一个整体，以 "$1 $2 … $n" 的形式输出所有参数； "`$@`"会将各个参数分开，以 "$1"、"$2"、…、"$n" 的形式输出所有参数。

```bash
#!/bin/bash

echo "\$* = " $*
echo "\"\$*\" = " "$*"

echo "\$@ = " $@
echo "\"\$@\" = " "$@"

echo "打印 \$* 中的每一个参数: "
for var in $*
do
    echo "$var"
done

echo "打印 \$@ 中的每一个参数: "
for var in $@
do
    echo "$var"
done

echo "从 \"\$*\" 获取并打印每一个参数: "
for var in "$*"
do
    echo "$var"
done

echo "从 \"\$@\" 获取并打印每一个参数: "
for var in "$@"
do
    echo "$var"
done
```

运行及输出：

```bash
$ ./test.sh A B B D E
$* =  A B B D E
"$*" =  A B B D E
$@ =  A B B D E
"$@" =  A B B D E
打印 $* 中的每一个参数:
A
B
B
D
E
打印 $@ 中的每一个参数:
A
B
B
D
E
从 "$*" 获取并打印每一个参数:
A B B D E
从 "$@" 获取并打印每一个参数:
A
B
B
D
E
```

## shift 使用

`shift`  命令用于对参数的移动(左移)，通常用于在不知道传入参数个数的情况下依次遍历每个参数然后进行相应处理,常见于 Linux 中各种程序的启动脚本。

### 1. 每次移动一个参数

示例：依次读取输入的参数并打印参数个数

- shift1.sh

```shell
#!/bin/bash
while [ $# != 0 ]
do
    echo -e "参数值为 $1, 参数个数为 $#"
    shift
done
```

- 输入如下命令运行：

```bash
$ sh shift1.sh a b c  d
参数值为 a, 参数个数为 4
参数值为 b, 参数个数为 3
参数值为 c, 参数个数为 2
参数值为 d, 参数个数为 1
```

**每次运行 shift(不带参数的)，销毁一个参数（变量的个数($#)减一），后面的参数前移（不管参数之间相隔一个或者多个空格）。**

### 2.  每次移动多个参数

shift 命令一次移动参数的个数由其所带的参数指定。例如，现在有 $1, $2, $3, ...，$9 个参数，当 shell 程序处理完前 4 个命令行参数后(即还剩下后面 5 个参数)，可以使用 `shift 4`  命令把 $9 移到 $1。

示例：自定义 shift 每次移动的参数个数。

- shift2.sh

```bash
#!/bin/bash
while [ $# -gt 5 ]
do
    echo -e "参数值为 $1, 参数个数为 $#"
    shift
done
shift 4
echo -e "参数值为 $1, 参数个数为 $#"
```

- 输入如下命令运行

```bash
$ sh shift2.sh a1 b2 c3 d4 e5 f6 g7 h8 i9
参数值为 a1, 参数个数为 9
参数值为 b2, 参数个数为 8
参数值为 c3, 参数个数为 7
参数值为 d4, 参数个数为 6
参数值为 i9, 参数个数为 1
```

### 3. 常与 case 条件配合使用

`case ..... esac`  和 `if ... then ... fi`  一样，都是条件判断式的语句结构，它们用倒序的字母单词和正序的单词配对，比如 `if`  语句，结束时用 `fi`  来配对， `esac`  和 `case`  配对，是多路分支的语句，类似于 C 中的 `switch/case`  语句，大致形式如下：

```bash
case $参数变量 in   # 以关键字 case 作为开始
"变量值1"）         # 变量值用双引号括起来，关键字用小括号括起来
    程序段1         # 对应的逻辑
    ;;              # 每个类别结尾使用两个连续的分号来处理
"变量值2"）
    程序段2
    ;;
"变量值3"）
    程序段3
    ;;
*)                 # 最后一个位置参数值会用*来代替所有其他值
    程序段4
    ;;
esac               # 关键字 esac(case 的反写) 结束
```

`shift`  操作经常与 `case ... esac`  条件分支配合使用。

示例： `shift`  搭配 `case ... esac`  实现 shell 脚本手动传递参数处理

- shift3.sh

```bash
while [ -n "$1" ]
do
  case "$1" in
    -a)
        echo "发现 -a 选项"
        ;;
    -b)
        echo "发现 -b 选项"
        echo "-b 选项的参数值是：$2"
        shift
        ;;
    -c)
        echo "发现 -c 选项"
        echo "-c 选项的参数值是：$2"
        shift
        ;;
    *)
        echo "$1 是一个未知选项"
        ;;
  esac
  shift
done
```

- 输入如下命令运行

```bash
$ sh shift3.sh -a -b 200 -c 300 -d 400
发现 -a 选项
发现 -b 选项
-b 选项的参数值是：200
发现 -c 选项
-c 选项的参数值是：300
-d 是一个未知选项
400 是一个未知选项
```

## 简单总结

在 bash shell 中解析命令行参数的方法有很多，网络上介绍的各种方法中，都可以看到它们与 `shift`  命令搭配使用的身影，因此在深入这一部分编程前，很有必要先了解一下 `shift`  的作用。这里只是抛砖引玉简单介绍一下，更多技巧还请大家不断去实践理解。

本篇文章的部分内容和代码来源于网络，但都经本人一一验证过，如有侵权或者其他问题，欢迎留言。
